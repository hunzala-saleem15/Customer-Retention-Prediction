{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <h2 class="text-center fw-bold mb-4 animate__animated animate__fadeInDown" style="color:#81d4fa;">
    Customer Churn Prediction
  </h2>

  <div class="card shadow-lg border-0 p-4 animate__animated animate__fadeInUp" 
       style="border-radius: 1rem; background-color: rgba(30,60,114,0.85); color: #e1f5fe;">
    <form id="multiStepForm" action="{{ url_for('predict') }}" method="POST">

      <!-- Step Progress -->
      <div class="progress mb-4" style="height: 20px; background-color: rgba(255,255,255,0.2); border-radius:10px;">
        <div id="progressBar" class="progress-bar bg-info" role="progressbar" style="width: 25%;">
          Step 1 of 4
        </div>
      </div>

      <!-- Step 1: Customer Info -->
      <div class="form-step active">
        <h5 class="mb-3"><i class="bi bi-person-fill me-2" style="color:#81d4fa;"></i>Customer Information</h5>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">Gender</label>
            <select class="form-select step-input" name="gender" required>
              <option value="Male" selected>Male</option>
              <option value="Female">Female</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Senior Citizen</label>
            <select class="form-select step-input" name="senior_citizen" required>
              <option value="Yes" selected>Yes</option>
              <option value="No">No</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Partner</label>
            <select class="form-select step-input" name="partner" required>
              <option value="Yes" selected>Yes</option>
              <option value="No">No</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Dependents</label>
            <select class="form-select step-input" name="dependents" required>
              <option value="Yes" selected>Yes</option>
              <option value="No">No</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 2: Services -->
      <div class="form-step">
        <h5 class="mb-3"><i class="bi bi-gear-fill me-2" style="color:#81d4fa;"></i>Services</h5>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">Phone Service</label>
            <select class="form-select step-input" name="phone_service" required>
              <option value="Yes" selected>Yes</option>
              <option value="No">No</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Internet Service</label>
            <select class="form-select step-input" name="internet_service" required>
              <option value="DSL" selected>DSL</option>
              <option value="Fiber optic">Fiber optic</option>
              <option value="No">No</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Streaming TV</label>
            <select class="form-select step-input" name="streaming_tv" required>
              <option value="Yes" selected>Yes</option>
              <option value="No">No</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Streaming Movies</label>
            <select class="form-select step-input" name="streaming_movies" required>
              <option value="Yes" selected>Yes</option>
              <option value="No">No</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 3: Billing -->
      <div class="form-step">
        <h5 class="mb-3"><i class="bi bi-wallet-fill me-2" style="color:#81d4fa;"></i>Billing Details</h5>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">Contract</label>
            <select class="form-select step-input" name="contract" required>
              <option value="Month-to-month">Month-to-month</option>
              <option value="One year" selected>One year</option>
              <option value="Two year">Two year</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Payment Method</label>
            <select class="form-select step-input" name="payment_method" required>
              <option value="Bank transfer (automatic)" selected>Bank transfer</option>
              <option value="Credit card (automatic)">Credit card</option>
              <option value="Electronic check">Electronic check</option>
              <option value="Mailed check">Mailed check</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Tenure (Months)</label>
            <input type="number" class="form-control step-input" name="tenure_months" required>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Monthly Charges</label>
            <input type="number" step="any" class="form-control step-input" name="monthly_charges" required>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Total Charges</label>
            <input type="number" step="any" class="form-control step-input" name="total_charges" required>
          </div>
        </div>
      </div>

      <!-- Step 4: Review & Submit -->
      <div class="form-step">
        <h5 class="mb-3"><i class="bi bi-check-circle-fill me-2" style="color:#81d4fa;"></i>Review & Submit</h5>
        <p class="text-light">Please review your inputs before submission.</p>
      </div>

      <!-- Navigation Buttons -->
      <div class="d-flex justify-content-between mt-4">
        <button type="button" class="btn btn-secondary prev-step"><i class="bi bi-arrow-left me-2"></i>Back</button>
        <button type="button" class="btn btn-info next-step float-end">Next<i class="bi bi-arrow-right ms-2"></i></button>
        <button type="submit" class="btn btn-success float-end d-none" id="submitBtn">Predict <i class="bi bi-check-circle ms-2"></i></button>
      </div>

    </form>
  </div>
</div>

<!-- JS for Wizard -->
<script>
const steps = document.querySelectorAll(".form-step");
const nextBtns = document.querySelectorAll(".next-step");
const prevBtns = document.querySelectorAll(".prev-step");
const progressBar = document.getElementById("progressBar");
const submitBtn = document.getElementById("submitBtn");

let currentStep = 0;

function updateStep() {
  steps.forEach((step, index) => step.classList.toggle("active", index === currentStep));
  let percent = ((currentStep + 1) / steps.length) * 100;
  progressBar.style.width = percent + "%";
  progressBar.innerText = "Step " + (currentStep + 1) + " of " + steps.length;

  // Show/hide buttons
  submitBtn.classList.toggle("d-none", currentStep !== steps.length - 1);
  nextBtns.forEach(btn => btn.classList.toggle("d-none", currentStep === steps.length - 1));
}

nextBtns.forEach(btn => btn.addEventListener("click", () => {
  currentStep++;
  updateStep();
}));

prevBtns.forEach(btn => btn.addEventListener("click", () => {
  currentStep--;
  updateStep();
}));

updateStep(); // initialize
</script>

<!-- Animate.css CDN and Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
/* Form Styling */
.card form select,
.card form input {
  background-color: rgba(30,60,114,0.25);
  color: #e1f5fe;
  border-radius: 0.5rem;
}
.card form select:focus,
.card form input:focus {
  outline: none;
  box-shadow: 0 0 10px #81d4fa;
}

/* Progress Bar */
.progress-bar {
  font-weight: 600;
  text-align: center;
}

/* Button Hover Effects */
.btn-info, .btn-success {
  transition: all 0.3s ease;
}
.btn-info:hover {
  transform: translateY(-2px);
  background-color: #64b5f6;
}
.btn-success:hover {
  transform: translateY(-2px);
  background-color: #4caf50;
}

/* Step Animation */
.form-step {
  display: none;
  animation: fadeIn 0.6s ease;
}
.form-step.active {
  display: block;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}
